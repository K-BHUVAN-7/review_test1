<div class="container-fluid" style="height: 100%;">

    <div class="d-flex justify-content-between mb-3">
  
        <div class="d-flex" style="cursor: pointer;" (click)="openRentModal()">

            <i class="bi bi-chevron-compact-left pe-1"></i>

            <h5>Rent Unit Details</h5>

        </div>
  
        <small><span class="text-primary">Rental</span> <img src="images/breadcrumbs.png" alt="" style="width: 16px;" class="ms-1 me-1"> <span class="text-primary" style="cursor: pointer;" (click)="this.service.navigate({ 'url': 'app/payment/rent' })">Rental List</span> <img src="images/breadcrumbs.png" alt="" style="width: 16px;" class="ms-1 me-1"> <span class="text-dark"> Rental Details</span> </small>
  
    </div>
  
    <div class="card border-0" style="box-shadow: 0 0 2px 2px rgba(0, 0, 0, 0.051);">
  
        <div class="card-header bg-white">
    
            <div class="d-flex justify-content-between align-items-center" style="height: 40px;">
    
                <h6 class="ps-2 my-0" style="font-weight: 600; border-left: 3px solid #D2A119;">Rent Details</h6>
                
                <!-- <img src="images/download.png" style="width: 26px; height: auto;" alt=""> -->
            
            </div>
                
        </div>
  
        <div class="card-body">
    
            <div class="card rounded-0">
        
                <div class="card-body rounded-0">
        
                    <div class="d-flex justify-content-between">
        
                        <div class="d-flex">
            
                            <div class="position-relative">
                
                                <img src="images/searchBlack.png" class="position-absolute search-icon" style="width: 25px;top: 6px;left: 8px;">
                            
                                <input type="text" class="form-control" placeholder="Search here..." style="background: transparent !important; border-radius: 8px !important; padding-left: 40px;">
                    
                            </div>
            
                            <!-- <div style="border: 1px solid #D8D8D8;" class="px-3 ms-2 d-flex align-items-center rounded-3">
            
                            <img src="images/filterVapour.png" style="width: 18px;" alt=""><span class="ms-2">Filter</span>
            
                            </div> -->
            
                        </div>
        
                    </div>
        
                    <div class="mt-3">
        
                    <div class="table-responsive table-wrapper">
        
                        <table class="table table-borderless align-middle table-scroll">
        
                            <thead class="bg-light text-secondary">
            
                                <tr>
            
                                    <th class="th-first-field">Bill Date</th>

                                    <th style="min-width: 140px;">Due Date</th>
                
                                    <th style="min-width: 120px;">Rent</th>
                
                                    <th style="min-width: 150px;">Paid Amount</th>
                
                                    <th style="min-width: 180px;">Paid Outstanding</th>
                
                                    <th class="th-status" style="min-width: 155px !important;">Status</th>
                
                                    <th style="text-align: center !important; min-width: 120px !important;" class="th-action">Action</th>
            
                                </tr>
            
                            </thead>
                        
                            <tbody>
            
                                <ng-container *ngIf="!_.isEmpty(masterList['detailRentList']); else other">

                                    <tr *ngFor="let rent of this.masterList['detailRentList']">
                
                                        <td class="td-first-field">{{ rent.billDate | date: 'dd-MM-yyyy' }}</td>

                                        <td>{{ rent.dueDate | date: 'dd-MM-yyyy' }}</td>
                
                                        <td>{{ this.service.currencyCode?.currencyCode }}. {{ (rent?.amountDue | number: '1.0') || 0 }}</td>
                
                                        <td>{{ this.service.currencyCode?.currencyCode }}. {{ (rent.amountPaid | number: '1.0') || 0 }}</td> 
                
                                        <!-- <td>{{ this.service.currencyCode?.currencyCode }}. {{ (rent.amountOutstanding | number: '1.0') || 0 }}</td> -->

                                        <td>{{ (service.currencyCode?.currencyCode + '. ' + (getRentStatus(rent) == 'Not yet Due' ? 0 : ((rent.amountOutstanding | number:'1.0') || 0))) }}</td>
                
                                        <td class="td-status">

                                            <ng-container [ngSwitch]="getRentStatus(rent)">

                                                <font *ngSwitchCase="'Upcoming'" color="#FF9500">Upcoming</font>

                                                <font *ngSwitchCase="'Overdue'" color="#C92E2E">Overdue</font>

                                                <font *ngSwitchCase="'Not yet Due'" color="#FF9500">Not yet Due</font>

                                                <font *ngSwitchCase="'Paid'" color="#34C759">Paid</font>

                                                <font *ngSwitchCase="'Free'" color="#34C759">Free</font>

                                                <font *ngSwitchDefault>-</font>

                                            </ng-container>
                                            
                                        </td>

                                        <!-- <td class="d-flex justify-content-center th-action">

                                            <img src="images/icons/history-outline.svg" class="me-3" style="width: 26px; height: auto; cursor: pointer;" alt="" (click)="openHistoryModal(rent)" />

                                            <div>

                                                <ng-container *ngIf="userDetails?.userType == 'tenant'">

                                                    <small *ngIf="isAnyBillNotApproved(rent?.paymentEntries)" class="me-2" style="color: #a0a0a0; font-size: 13px;">

                                                        Approved Pending

                                                    </small>

                                                </ng-container>

                                                <ng-container *ngIf="shouldShowApproveButton(rent)">

                                                    <button class="btn btn-sm btn-secondary me-2" (click)="openRentApproveModal(rent)">

                                                        Approve
                                                    
                                                    </button>
                                                
                                                </ng-container>

                                                Pay button (for tenant or manager)
                                                <button *ngIf="shouldShowPayButton(rent)" class="btn btn-sm payment-button fw-500" (click)="openUpdatePaymentModal(rent?._id)">

                                                    Pay
                                                    
                                                </button>

                                            </div>

                                        </td> -->

                                        <ng-container *ngIf="this.userDetails?.userType != 'admin'; else otherUser">

                                            <td class="th-action d-flex justify-content-between" >

                                                <div>

                                                    <img src="images/icons/history-outline.svg" class="ms-5" style="width: 26px; height: auto; cursor: pointer;" alt="" (click)="openHistoryModal(rent)" />

                                                </div>

                                                <!-- <div class="me-5">

                                                    <ng-container *ngIf="this.permissions?.approvePermission?.branchIds?.length > 0">
                                                        
                                                        <small *ngIf="isAnyBillNotApproved(rent?.paymentEntries)" style="color: #a0a0a0; font-size: 13px; margin-right: -38px !important;">

                                                            Approved Pending
                                                            
                                                        </small>

                                                    </ng-container>

                                                    <ng-container *ngIf="shouldShowApproveButton(rent)" >

                                                        <button class="btn btn-sm btn-secondary" style="margin-right: -17px !important;" (click)="openRentApproveModal(rent)">

                                                            Approve

                                                        </button>
                                                        
                                                    </ng-container>
                                                    <button *ngIf="shouldShowPayButton(rent)" class="btn btn-sm payment-button fw-500" style="margin-left: 21px !important;" (click)="openUpdatePaymentModal(rent?._id)">

                                                        Pay

                                                    </button>

                                                </div> -->

                                                <div class="me-5">

                                                    <ng-container *ngIf="shouldShowApprovePending(rent)">

                                                        <small style="color: #a0a0a0; font-size: 13px; margin-right: -38px !important;">

                                                            Approve Pending

                                                        </small>

                                                    </ng-container>

                                                    <ng-container *ngIf="shouldShowApproveButton(rent)">

                                                        <button class="btn btn-sm btn-secondary" style="margin-right: -17px !important;" (click)="openRentApproveModal(rent)">

                                                            Approve

                                                        </button>

                                                    </ng-container>

                                                    <button *ngIf="shouldShowPayButton(rent)" class="btn btn-sm payment-button fw-500" style="margin-left: 21px !important;" (click)="openUpdatePaymentModal(rent?._id)">

                                                        Pay

                                                    </button>

                                                </div>

                                                <!-- <small *ngIf="hasRejectedBills(rent?.paymentEntries)"
                                                        class="badge bg-danger ms-2">
                                                    Rejected
                                                </small> -->

                                            </td>

                                        </ng-container>

                                        <ng-template #otherUser>

                                            <td class="th-action d-flex justify-content-center">

                                                <img src="images/icons/history-outline.svg" class="ms-5" style="width: 26px; height: auto; cursor: pointer; margin-right: 38px;" alt="" (click)="openHistoryModal(rent)" />

                                            </td>

                                        </ng-template>

                                    </tr>

                                </ng-container>
                
                                <ng-template #other>
            
                                    <tr >
            
                                        <td colspan="10" style="text-align: center !important;">No Records Found</td>
            
                                    </tr>
            
                                </ng-template>
        
                            </tbody>
            
                        </table>
        
                    </div>

                        <div *ngIf="totalCount > 0">

                            <mat-paginator 
                                class="custom-paginator"
                                appendTo="body"
                                [length]="totalCount"
                                [pageSize]="pageSize"
                                [pageIndex]="pageIndex"
                                [pageSizeOptions]="[5, 10, 25, 50]"
                                (page)="onPageChange($event)">
                            </mat-paginator>

                        </div>  
        
                    </div>
        
                </div>
                
            </div>
    
        </div>
  
    </div>
  
</div>
  
<!-- Rent History Modal -->
<ng-template #detailHistoryModal let-modal>

    <div class="modal-header">

        <div class="d-flex justify-content-between align-items-center w-100" style="height: 40px;">

            <h6 class="ps-2 my-0" style="font-weight: 600; border-left: 3px solid #D2A119 ;">Rental List</h6>
            
            <i class="bi bi-x-lg pe-2 fw-bold" (click)="modal.close()"></i>
        
        </div>

    </div>

    <div class="modal-body">

        <div class="mt-3">

            <div class="table-responsive">

                <table class="table table-borderless align-middle table-striped">

                    <thead class="bg-light text-secondary">

                        <tr>

                            <th>Payment Date</th>

                            <th>Amount</th>

                            <th>Payment Mode</th>

                            <th>PDC</th>

                            <th>PDC Date</th>
                            
                            <!-- <th>Bank</th> -->
                            
                            <!-- <th>Bank Branch</th> -->
                            
                            <!-- <th>Cheque No</th> -->

                            <th>Request</th>

                            <th>Approved</th>

                            <th>Status</th>

                        </tr>

                    </thead>
                
                    <tbody>

                        <ng-container *ngIf="!_.isEmpty(this.selectedData?.paymentEntries); else other">

                            <tr *ngFor="let rent of this.selectedData?.paymentEntries">

                                <td>{{ (rent.paymentDate | date: 'dd-MM-yyyy') || '-' }}</td>

                                <td>{{ this.service.currencyCode?.currencyCode }}. {{ (rent?.amountPaid | number: '1.0') || '-' }}</td>

                                <td>{{ (rent.paymentMode | titlecase) || '-' }}</td>
                                
                                <td>{{ (rent.isPdc == true ? 'Yes' : 'No') }}</td>
                                
                                <td>{{ (rent.chequeDate | date: 'dd-MM-yyyy') || '-' }}</td>
                                
                                <!-- <td>{{ (rent.bank) || '-' }}</td> -->

                                <!-- <td>{{ rent.bankBranch || '-' }}</td> -->

                                <!-- <td>{{ rent.chequeNo || '-' }}</td> -->

                                <td>{{ rent.requestedBy?.firstName || '-' }}</td>
                                
                                <td>{{ rent.approvedBy?.firstName || '-' }}</td>

                                <td>
                                    
                                    <font color="#34C759" *ngIf="rent.status == 'approved'">{{ rent.status | titlecase }}</font>

                                    <font color="#C92E2E" *ngIf="rent.status == 'rejected'">{{ rent.status | titlecase }}</font>

                                    <font color="#FF9500" *ngIf="rent.status == 'pending'">{{ rent.status | titlecase }}</font>
                                    
                                </td>

                            </tr>

                        </ng-container>

                        <ng-template #other>

                            <tr>

                                <td colspan="12" style="text-align: center !important;">No Records Found</td>

                            </tr>

                        </ng-template>

                        <ng-template #other>

                            <tr>

                                <td colspan="12" style="text-align: center !important;"><img style="width: 16px !important;" class="me-2" src="images/lock2.png" alt="">Access Denied</td>

                            </tr>

                        </ng-template>

                    </tbody>

                </table>

            </div>

        </div>

    </div>

</ng-template>

<!-- Rent Approvel Modal -->
<ng-template #rentApproveModal let-modal>

    <div class="modal-header">

        <div class="d-flex justify-content-between align-items-center w-100" style="height: 40px;">

        <h6 class="ps-2 my-0" style="font-weight: 600; border-left: 3px solid #D2A119 ;">Rental Details</h6>
        
        <i class="bi bi-x-lg pe-2 fw-bold" (click)="modal.close()"></i>
        
        </div>

    </div>

    <div class="modal-body pb-2" style="color: black;">

        <div class="row">

            <div class="col-5"> <small>Property Name</small> </div>
            
            <div class="col-1"> : </div>
            
            <div class="col-6"> <small>{{ selectedData.property?.propertyName }}</small> </div>

        </div>

        <div class="row mt-2">

            <div class="col-5"> <small>Unit</small> </div>
            
            <div class="col-1"> : </div>
            
            <div class="col-6"> <small>{{ selectedData.unit?.unitName }}</small> </div>

        </div>

        <div class="row mt-2">

            <div class="col-5"> <small>Tenant Name</small> </div>
            
            <div class="col-1"> : </div>
            
            <div class="col-6"> <small>{{ selectedData.tenantId?.firstName + ' ' + selectedData.tenantId?.lastName }}</small> </div>

        </div>

        <div class="row mt-2">

            <div class="col-5"> <small>Contract Amount</small> </div>
            
            <div class="col-1"> : </div>
            
            <div class="col-6"> <small>{{ this.service.currencyCode?.currencyCode }}. {{ (selectedData.amountDue) | number: '1.0' }}</small> </div>

        </div>

        <div class="row mt-2">

            <div class="col-5"> <small>Paid Amount</small> </div>
            
            <div class="col-1"> : </div>
            
            <div class="col-6"> <small>{{ this.service.currencyCode?.currencyCode }}. {{ (selectPaymentEntry.amountPaid) | number: '1.0' }}</small> </div>

        </div>

        <div class="row mt-2">

            <div class="col-5"> <small>Amount Outstanding</small> </div>
            
            <div class="col-1"> : </div>
            
            <div class="col-6"> <small>{{ this.service.currencyCode?.currencyCode }}. {{ (selectPaymentEntry.amountOutstanding | number: '1.0') }}</small> </div>

        </div>

    </div>

    <div class="modal-footer d-flex justify-content-end me-2">

        <button class="btn btn-sm btn-outline-secondary" (click)="rejectRent(selectedData)">Reject</button>

        <button class="btn btn-sm btn-secondary" (click)="approveRent(selectedData)">Approve</button>

    </div>

</ng-template>